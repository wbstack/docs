<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vitess vs Mysql / Mariadb | WBStack</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Documentation site for WBStack">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.f3f98661.css" as="style"><link rel="preload" href="/assets/js/app.751ddebd.js" as="script"><link rel="preload" href="/assets/js/2.d7597798.js" as="script"><link rel="preload" href="/assets/js/19.1b016d38.js" as="script"><link rel="prefetch" href="/assets/js/10.18320322.js"><link rel="prefetch" href="/assets/js/11.0891f683.js"><link rel="prefetch" href="/assets/js/12.9c1d8c5a.js"><link rel="prefetch" href="/assets/js/13.e506444f.js"><link rel="prefetch" href="/assets/js/14.32e0fc04.js"><link rel="prefetch" href="/assets/js/15.5e13bf42.js"><link rel="prefetch" href="/assets/js/16.a81ac360.js"><link rel="prefetch" href="/assets/js/17.a79f7db5.js"><link rel="prefetch" href="/assets/js/18.6c5bd850.js"><link rel="prefetch" href="/assets/js/20.5a7c335b.js"><link rel="prefetch" href="/assets/js/21.11e19e43.js"><link rel="prefetch" href="/assets/js/22.bb79fcc1.js"><link rel="prefetch" href="/assets/js/23.67fa322e.js"><link rel="prefetch" href="/assets/js/24.2555ab51.js"><link rel="prefetch" href="/assets/js/25.2ffaad60.js"><link rel="prefetch" href="/assets/js/26.7edb7b0e.js"><link rel="prefetch" href="/assets/js/27.382d4fd4.js"><link rel="prefetch" href="/assets/js/28.2996ce31.js"><link rel="prefetch" href="/assets/js/29.3c442902.js"><link rel="prefetch" href="/assets/js/3.72ce2306.js"><link rel="prefetch" href="/assets/js/30.93f6cd16.js"><link rel="prefetch" href="/assets/js/31.ea63f9a1.js"><link rel="prefetch" href="/assets/js/32.f17d81d4.js"><link rel="prefetch" href="/assets/js/33.f518b9a3.js"><link rel="prefetch" href="/assets/js/34.1d5d4812.js"><link rel="prefetch" href="/assets/js/35.41158f80.js"><link rel="prefetch" href="/assets/js/36.91ed0fc3.js"><link rel="prefetch" href="/assets/js/37.cc32c2a5.js"><link rel="prefetch" href="/assets/js/38.245b516b.js"><link rel="prefetch" href="/assets/js/39.c71dea4a.js"><link rel="prefetch" href="/assets/js/4.6eb5a754.js"><link rel="prefetch" href="/assets/js/40.1156b4f8.js"><link rel="prefetch" href="/assets/js/41.86e26636.js"><link rel="prefetch" href="/assets/js/42.be99d387.js"><link rel="prefetch" href="/assets/js/43.a07c72c1.js"><link rel="prefetch" href="/assets/js/44.ea3b790a.js"><link rel="prefetch" href="/assets/js/45.ede7a59e.js"><link rel="prefetch" href="/assets/js/46.bb37262e.js"><link rel="prefetch" href="/assets/js/47.01c169fc.js"><link rel="prefetch" href="/assets/js/48.8e07b91b.js"><link rel="prefetch" href="/assets/js/49.0e268fb7.js"><link rel="prefetch" href="/assets/js/5.d74740a2.js"><link rel="prefetch" href="/assets/js/50.af335508.js"><link rel="prefetch" href="/assets/js/51.a6452493.js"><link rel="prefetch" href="/assets/js/52.8e039987.js"><link rel="prefetch" href="/assets/js/53.8aca6647.js"><link rel="prefetch" href="/assets/js/54.f2a0b93a.js"><link rel="prefetch" href="/assets/js/55.85bed42b.js"><link rel="prefetch" href="/assets/js/56.42ee4c6a.js"><link rel="prefetch" href="/assets/js/57.7f09cde0.js"><link rel="prefetch" href="/assets/js/6.d8611671.js"><link rel="prefetch" href="/assets/js/7.93e686c3.js"><link rel="prefetch" href="/assets/js/8.791a3f75.js"><link rel="prefetch" href="/assets/js/9.160da74a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f3f98661.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">WBStack</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/about/" class="nav-link">
  About
</a></div><div class="nav-item"><a href="/tech/" class="nav-link router-link-active">
  Tech Docs
</a></div><div class="nav-item"><a href="/users/" class="nav-link">
  User Docs
</a></div><div class="nav-item"><a href="https://wikibase.cloud" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Wikibase.cloud
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.github.com/wbstack" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/about/" class="nav-link">
  About
</a></div><div class="nav-item"><a href="/tech/" class="nav-link router-link-active">
  Tech Docs
</a></div><div class="nav-item"><a href="/users/" class="nav-link">
  User Docs
</a></div><div class="nav-item"><a href="https://wikibase.cloud" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Wikibase.cloud
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.github.com/wbstack" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>General</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Google Cloud</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Kubernetes</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Services</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Decision Records</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tech/decisions/" aria-current="page" class="sidebar-link">Overview</a></li><li><a href="/tech/decisions/0000-gce-vs-other-k8s-cluster.html" class="sidebar-link">GCE vs other Kubernetes clusters</a></li><li><a href="/tech/decisions/0001-gce-kubernetes-cluster-private-vs-public.html" class="sidebar-link">Private vs Public GCE kubernetes cluster</a></li><li><a href="/tech/decisions/0002-gce-ingress-vs-nginx.html" class="sidebar-link">GCE Ingress vs Nginx</a></li><li><a href="/tech/decisions/0003-vitess-vs-mysql.html" aria-current="page" class="active sidebar-link">Vitess vs Mysql / Mariadb</a></li><li><a href="/tech/decisions/0004-one-wdqs-vs-cluster.html" class="sidebar-link">One WDQS server vs a cluster</a></li><li><a href="/tech/decisions/0005-backend-apis-and-services.html" class="sidebar-link">Backend APIs and Services</a></li><li><a href="/tech/decisions/0006-wiki-access.html" class="sidebar-link">Public access of Wikis</a></li><li><a href="/tech/decisions/0008-custom-domains-ingress-creation.html" class="sidebar-link">Custom domain ingress creation</a></li><li><a href="/tech/decisions/0009-api-using-laravel.html" class="sidebar-link">API using Laravel framework</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vitess-vs-mysql-mariadb"><a href="#vitess-vs-mysql-mariadb" class="header-anchor">#</a> Vitess vs Mysql / Mariadb</h1> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>This decision document has not yet been formatted for nice display...</p></div> <p>Date: 23 August 2019
Decision: Simple MySQL replicated DB for now. Maybe Vitess later.</p> <p>Even if OC grows quickly, there is no clear need for vitess for immediate sharding.
A single master setup (at least for wiki dbs) should suffice, and if it does not the
easiest step forward for scalability would be to just create 1 more shard and create new
dbs there, optionally moving old dbs.
This would require storing the shard / service / host of the wiki as well as the db name,
but this is trivial.</p> <p>https://vitess.io/docs/user-guides/production-planning/ specifices how much overhead
vitess would bring to the initial setup, likely resulting in more immediate cost.</p> <p>It also says:
&quot;Before running Vitess in production, please make yourself comfortable first with the different operations. We recommend to go through the following scenarios on a non-production system.&quot;
Which I have not yet done, and don't really have time to do, so this seems a bit risky...</p> <p>Follow up:
Date: 27 August 2019</p> <p><strong>Vitess Notes</strong></p> <p>Vitess could be used to control all MySQL servers for OpenCura.</p> <h3 id="todo"><a href="#todo" class="header-anchor">#</a> TODO</h3> <p>Make sure mediawiki generally works through vitess....?</p> <h3 id="resources"><a href="#resources" class="header-anchor">#</a> Resources</h3> <p>https://vitess.io/docs/user-guides/production-planning/</p> <h3 id="deployment"><a href="#deployment" class="header-anchor">#</a> Deployment?</h3> <p>Vitess supports MySQL 5.6, MariaDB 10.0, and any newer versions like MySQL 5.7, etc.
We probably want to start working with the operator out of the box.
https://github.com/vitessio/vitess-operator
https://github.com/vitessio/vitess-operator/blob/master/my-vitess.yaml</p> <p>MySQL users will have to be created with permissions for a set of table prefixes or specific tables
rather than by db name which is currently done in the general setup.</p> <h3 id="_2x-vgates-master-vs-replica"><a href="#_2x-vgates-master-vs-replica" class="header-anchor">#</a> 2x Vgates (master vs replica)</h3> <p>If no tablet type was specified, then VTGate chooses its default, which can be overridden with the -default_tablet_type command line argument.
Documented on https://vitess.io/docs/faq/queries/</p> <p>From slack https://vitess.slack.com/archives/C0PQY0PTK/p1566945049394300:
&quot;
Yes, you can use the default_tablet_type parameter to specify the default tablet type a vtgate will route queries to.In conjunction with setting the default_tablet_type parameter to either master or replica, you may also want to limit the types of tablets these vtgates can route queries to. This can be accomplished via the allowed_tablet_types VTgate parameter, which enables users to define which tablet types a VTgate is allowed to route queries to:</p> <p>-allowed_tablet_types value
Specifies the tablet types this vtgate is allowed to route queries to
&quot;</p> <h3 id="keyspaces"><a href="#keyspaces" class="header-anchor">#</a> Keyspaces</h3> <p>An initial starting point would be to have a single keyspace.
https://vitess.io/docs/concepts/keyspace/
Essentially a single MySQL DB server running. (cuts down on costs initially).</p> <p>Vertical sharding can be used to move tables from an unsharded keyspace into a
different keyspace as described on https://vitess.io/docs/reference/sharding/
This will require table names to NOT conflict initially.
Idea:</p> <ul><li>Mediawiki DBs will need to use table prefixes, resulting in things like:
mw_<DBNAME>_<tablename> for example.</tablename></DBNAME></li> <li>TODO DB table creation needs to be thought about?</li> <li>TODO API tables should include a table prefix? (can be done with DB_PREFIX)</li> <li>TODO eventlogging tables should include prefix? (currently mediawiki_revision_create_3)</li></ul> <h3 id="schema-creation"><a href="#schema-creation" class="header-anchor">#</a> Schema Creation</h3> <p>No schema creation should be needed initially.
Per https://vitess.io/docs/user-guides/mysql-schema/
&quot;
You can apply schema changes directly to MySQL. VTTablet will eventually notice the change and update itself. You can also explicitly issue the vtctlclient ReloadSchema command to make it reload immediately.
&quot;</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/wbstack/docs/edit/main/tech/decisions/0003-vitess-vs-mysql.md" target="_blank" rel="noopener noreferrer">Edit this page on Github!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/18/2022, 1:13:39 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/tech/decisions/0002-gce-ingress-vs-nginx.html" class="prev">
        GCE Ingress vs Nginx
      </a></span> <span class="next"><a href="/tech/decisions/0004-one-wdqs-vs-cluster.html">
        One WDQS server vs a cluster
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.751ddebd.js" defer></script><script src="/assets/js/2.d7597798.js" defer></script><script src="/assets/js/19.1b016d38.js" defer></script>
  </body>
</html>
